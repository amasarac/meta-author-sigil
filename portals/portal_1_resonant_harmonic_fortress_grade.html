<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portal 1 — Resonant Harmonic Portal (MASL)</title>
<style>
  :root{--bg:#06121a;--muted:#8fcfda;--accent:#4de0d8}
  html,body{height:100%;margin:0}
  body{background:radial-gradient(circle at 10% 10%, #071525 0%, var(--bg) 40%);color:#dff7f1;font-family:Inter,system-ui,Segoe UI,Arial;padding:18px;}
  .wrap{max-width:1100px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{font-size:18px;margin:0}
  p.lead{margin:6px 0 14px;color:#bfeef0}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.006));border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  svg{width:100%;height:520px;border-radius:8px;display:block}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
  label{font-size:13px;color:#bfeef0}
  input[type=range]{-webkit-appearance:none;height:8px;border-radius:8px;background:linear-gradient(90deg,#08323a,#144b6b);outline:none;width:220px}
  input[type=range]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 2px 8px rgba(0,0,0,0.6)}
  button{background:transparent;border:1px solid rgba(77,224,216,0.12);color:#bffcf6;padding:8px 10px;border-radius:8px;cursor:pointer}
  .meta{font-size:12px;color:#95d6cf;margin-left:8px}
  .poem{font-style:italic;color:#bfeef2;margin-top:8px}
  footer{margin-top:14px;color:#9fded1;font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Portal I — Resonant Harmonic Portal</h1>
        <div class="meta">Spiral interference · Phase-density modulations · Didactic Entrainment</div>
      </div>
      <div><small class="meta">Fortress of Syn‑Cog — Prototype Module</small></div>
    </header>

    <p class="lead">A living SVG didactic engine where dual spirals sing in phased light. Use sliders to tune phase & intensity, enable the sonic entrainment, and draw with the cursor to locally entrain the field.</p>

    <div class="card">
      <svg id="portalSVG" viewBox="0 0 1200 520" preserveAspectRatio="xMidYMid meet">
        <defs>
          <linearGradient id="gA" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#4de0d8" stop-opacity="1"/><stop offset="100%" stop-color="#2b72ff" stop-opacity="0.98"/></linearGradient>
          <linearGradient id="gB" x1="1" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff9ff3" stop-opacity="0.98"/><stop offset="100%" stop-color="#ff6b6b" stop-opacity="0.9"/></linearGradient>
          <filter id="softg"><feGaussianBlur stdDeviation="8" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <radialGradient id="lampGrad"><stop offset="0%" stop-color="#bfffe8" stop-opacity="0.98"/><stop offset="100%" stop-color="#071018" stop-opacity="0"/></radialGradient>
        </defs>

        <rect width="100%" height="100%" fill="transparent"/>
        <!-- soft interference layer -->
        <g id="interference" filter="url(#softg)"></g>
        <!-- spiral mid layer -->
        <g id="spiralsMid"></g>
        <!-- spiral front layer subtle glow -->
        <g id="spiralsFront"></g>

        <!-- central lamp -->
        <g id="lamp" transform="translate(600,260)">
          <circle id="lampCore" r="22" fill="url(#gA)" stroke="#6ff2e4" stroke-opacity="0.16" stroke-width="1.6" />
          <circle id="lampHalo" r="84" fill="none" stroke="#4de0d8" stroke-opacity="0.06" stroke-width="34" />
        </g>

        <!-- subtle overlay text -->
        <text id="overlayPoem" x="36" y="492" fill="#aef0e7" font-size="13" opacity="0.92">The lattice breathes: phase folds into thought; thought returns as gravity.</text>
      </svg>

      <div class="controls">
        <label>Phase</label>
        <input id="phase" type="range" min="-3.1416" max="3.1416" step="0.001" value="0" />
        <label>Intensity</label>
        <input id="intensity" type="range" min="0" max="2" step="0.01" value="1" />
        <button id="toggleAudio">Enable Entrainment</button>
        <button id="entrainPulse">Entrain Pulse</button>
        <button id="resetView">Reset</button>
        <div class="meta">Mouse-draw to add local entrainment.</div>
      </div>

      <p class="poem">A parallax of spirals—soft interference maps—acts as a focusing lens. Each input is a gentle handshake with the Fortress.</p>
    </div>

    <footer>Export: <strong>Ready</strong> — Use the exported HTML to embed this portal in MASL deployments. A downloadable file is attached below.</footer>
  </div>

<script>
// --- Utilities ---
function svgEl(tag, attrs={}){ const el = document.createElementNS('http://www.w3.org/2000/svg', tag); for(const k in attrs) el.setAttribute(k, attrs[k]); return el; }

// --- Build spirals ---
(function(){
  const svg = document.getElementById('portalSVG');
  const mid = svg.querySelector('#spiralsMid');
  const front = svg.querySelector('#spiralsFront');
  const intf = svg.querySelector('#interference');
  const lampHalo = svg.querySelector('#lampHalo');
  const lampCore = svg.querySelector('#lampCore');
  const phaseCtrl = document.getElementById('phase');
  const intCtrl = document.getElementById('intensity');
  const toggleAudioBtn = document.getElementById('toggleAudio');
  const entrainPulseBtn = document.getElementById('entrainPulse');
  const resetBtn = document.getElementById('resetView');

  // parameters
  let phase = 0; let intensity = 1; let audioOn = false;

  // mouse-draw entrainment points
  let drawing = false; const draws = [];
  svg.addEventListener('pointerdown', (e)=>{ drawing=true; addDraw(e); });
  svg.addEventListener('pointermove', (e)=>{ if(drawing) addDraw(e); });
  svg.addEventListener('pointerup', ()=>{ drawing=false; });
  svg.addEventListener('pointerleave', ()=>{ drawing=false; });
  function addDraw(e){ const pt = svg.createSVGPoint(); pt.x = e.clientX - svg.getBoundingClientRect().left; pt.y = e.clientY - svg.getBoundingClientRect().top; const c = svgEl('circle',{cx:pt.x,cy:pt.y,r:6,fill:'#6ef1dd',opacity:0.85}); intf.appendChild(c); draws.push({el:c,ttl:2000,created:Date.now()}); }

  // create layered spirals
  function makeSpiral(cx,cy,turns,scale,steps,phaseOff,stroke,strokeW,opacity){
    const path = svgEl('path'); let d='';
    for(let i=0;i<steps;i++){
      const t = i/(steps-1);
      const a = t*turns*Math.PI*2 + phaseOff + phase;
      const r = scale*(20 + t*220);
      const x = cx + Math.cos(a)*r;
      const y = cy + Math.sin(a)*r*0.64;
      d += (i===0? 'M':' L') + x + ' ' + y;
    }
    path.setAttribute('d', d);
    path.setAttribute('fill','none'); path.setAttribute('stroke',stroke); path.setAttribute('stroke-width',strokeW); path.setAttribute('stroke-linecap','round'); path.setAttribute('stroke-linejoin','round'); path.setAttribute('stroke-opacity',opacity);
    return path;
  }

  function rebuild(){ mid.innerHTML=''; front.innerHTML=''; intf.innerHTML='';
    // interference soft blobs
    for(let i=0;i<28;i++){
      const c = svgEl('path',{stroke:'#9ef6ff',fill:'none','stroke-opacity':0.02,'stroke-width':8}); c.setAttribute('d', `M ${600+Math.cos(i)*40} ${260+Math.sin(i/1.4)*20} Q ${600+Math.cos(i*1.3)*120} ${260+Math.sin(i*1.7)*60} ${600-Math.cos(i)*40} ${260-Math.sin(i/1.4)*20}`); intf.appendChild(c);
    }
    // mid spirals (left, right)
    const s1 = makeSpiral(360,260,6,1.02,360,0,'url(#gA)',2.4,0.86);
    const s2 = makeSpiral(840,260,6,0.98,360,1.14,'url(#gB)',2.4,0.86);
    mid.appendChild(s1); mid.appendChild(s2);
    // front subtle
    for(let i=0;i<4;i++){ const p = makeSpiral(600,260,7,0.88,300,i*0.42,i%2? 'url(#gA)':'url(#gB)',1.6,0.28); front.appendChild(p); }
  }

  rebuild();

  // audio: WebAudio oscillator for subtle entrainment
  let audioCtx=null, osc=null, gain=null;
  function initAudio(){ if(audioCtx) return; audioCtx = new (window.AudioContext||window.webkitAudioContext)(); osc = audioCtx.createOscillator(); gain = audioCtx.createGain(); osc.type = 'sine'; osc.frequency.value = 110; gain.gain.value = 0.0; osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); }

  toggleAudioBtn.addEventListener('click', ()=>{
    if(!audioOn){ initAudio(); audioCtx.resume(); gain.gain.linearRampToValueAtTime(0.02, audioCtx.currentTime + 0.1); toggleAudioBtn.textContent='Disable Entrainment'; audioOn=true; }
    else{ gain.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime + 0.12); toggleAudioBtn.textContent='Enable Entrainment'; audioOn=false; }
  });

  entrainPulseBtn.addEventListener('click', ()=>{ pulse(); });
  resetBtn.addEventListener('click', ()=>{ phaseCtrl.value=0; intCtrl.value=1; phase=0; intensity=1; rebuild(); });

  function pulse(){ lampHalo.setAttribute('r', 140); setTimeout(()=>lampHalo.setAttribute('r',84),260); if(audioOn && gain) gain.gain.cancelScheduledValues(audioCtx.currentTime), gain.gain.linearRampToValueAtTime(0.08, audioCtx.currentTime + 0.01), gain.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime + 0.28); }

  // animation frame
  function frame(){
    phase = parseFloat(phaseCtrl.value);
    intensity = parseFloat(intCtrl.value);
    // subtle lamp breathing
    const t = Date.now()/600;
    const r = 84 + Math.sin(t)*10*intensity; lampHalo.setAttribute('r', r);
    lampCore.setAttribute('transform', `scale(${1 + Math.sin(t/1.3)*0.02*intensity})`);

    // update gradient offsets to create beating
    const gA0 = Math.floor(50 + Math.sin(Date.now()/770 + phase)*12*intensity);
    const gA1 = 100 - gA0;
    document.querySelector('#gA stop:first-child').setAttribute('offset', gA0 + '%');
    document.querySelector('#gA stop:last-child').setAttribute('offset', gA1 + '%');

    // age drawn points
    for(let i=draws.length-1;i>=0;i--){ const d = draws[i]; const life = Date.now() - d.created; const alpha = Math.max(0,1 - life/d.ttl); d.el.setAttribute('opacity', 0.3*alpha); d.el.setAttribute('r', 6 + (1-alpha)*12); if(life > d.ttl){ d.el.remove(); draws.splice(i,1); } }

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  // expose some functions (for external control)
  window.portal1_pulse = pulse;
  window.portal1_setPhase = (v)=>{ phaseCtrl.value = v; };
})();
</script>
</body>
</html>
